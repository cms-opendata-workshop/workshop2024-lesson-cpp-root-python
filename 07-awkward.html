<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>ROOT for data analysis: Using awkward arrays to analyze HEP data</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="dpoa-logo" alt="CMS DPOA logo" src="assets/images/dpoa-logo.png"></div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/07-awkward.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="CMS DPOA small logo" src="assets/images/dpoa-logo-sm.png"></div>
    <div class="lesson-title-md">
      ROOT for data analysis
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            ROOT for data analysis
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  ROOT for data analysis
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 85%" class="percentage">
    85%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 85%" aria-valuenow="85" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/07-awkward.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-cpp-hello-world.html">2. Lightning overview of C++</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-root-and-cpp-read-and-write.html">3. Using ROOT with C++ to write and read a file</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-root-and-cpp-fill-a-histogram.html">4. Using ROOT with C++ to fill a histogram</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-going-further-with-pyroot.html">5. Using ROOT with python</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-uproot.html">6. Using uproot to open ROOT files</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        7. Using awkward arrays to analyze HEP data
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#environment">Environment</a></li>
<li><a href="#numpy-arrays-a-review">Numpy arrays: a review</a></li>
<li><a href="#access-or-download-a-root-file-for-use-with-this-exercise">Access or download a ROOT file for use with this exercise</a></li>
<li><a href="#open-the-file">Open the file</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>

                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html dummypushtext -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="06-uproot.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="06-uproot.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Using uproot to open
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Using awkward arrays to analyze HEP data</h1>
        <p>Last updated on 2024-07-02 |

        <a href="https://github.com/cms-opendata-workshop/workbench-template-md/edit/main/episodes/07-awkward.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What are awkward arrays?</li>
<li>How do I work with awkward arrays?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Learn to use awkward arrays in a simple, naive way.</li>
<li>Learn to use awkward arrays in a much faster way, making use of the
built-in functionality of the library.</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="why-awkward" class="callout testimonial">
<div class="callout-square">
<i class="callout-icon" data-feather="heart"></i>
</div>
<div id="why-awkward" class="callout-inner">
<h3 class="callout-title">Why awkward?<a class="anchor" aria-label="anchor" href="#why-awkward"></a>
</h3>
<div class="callout-content">
<p>A natural question to ask would be “<em>Why do I have to learn about
awkward? Why can’t I just use numpy?</em>” And yes, those are two
questions. :) The quick answers are: you don’t have to and you can! But
let’s dig deeper.</p>
<p>Awkward-array is a newer python tool written by Jim Pivarski
(Princeton) and others that allows for very fast manipulation of
``<em>jagged</em>” arrays, like we find in HEP. You definitely don’t
<em>have</em> to use it, but we present it here because it can speed
things up considerably…if you know how to write your code.</p>
<p>Similarly, you can of course use standard <code>numpy</code> arrays
for many parts of your analysis, but your data may not always fit into
<code>numpy</code> arrays without some careful attention to your code.
In either case, you’ll want to think about how to work with your data
once you get it out of your file.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="environment">Environment<a class="anchor" aria-label="anchor" href="#environment"></a>
<a class="anchor" aria-label="anchor" href="#environment"></a></h2>
<hr class="half-width"><p>Use the Python environment that you set up in the previous two lesson
pages, such as your <code>my_python</code> docker container. We leave it
up to you whether or not you write and execute this code in a script or
as a Jupyter notebook.</p>
</section><section><h2 class="section-heading" id="numpy-arrays-a-review">Numpy arrays: a review<a class="anchor" aria-label="anchor" href="#numpy-arrays-a-review"></a>
<a class="anchor" aria-label="anchor" href="#numpy-arrays-a-review"></a></h2>
<hr class="half-width"><p>Before we dive into <code>awkward</code> lets review some of the
awsome aspects of <code>numpy</code> arrays…and also examine their
limitations.</p>
<p>Let’s import <code>numpy</code> (if you have not already done that in
this python session).</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code></pre>
</div>
<p>Next, let’s make a simple <code>numpy</code> array to use for our
exmples.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>x <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="bu">print</span>(x)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1 2 3 4]</code></pre>
</div>
<p>Numpy arrays are great because we can perform mathematical operations
on them and the operation is quickly and efficiently carried out on
every member of the array.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>x</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="bu">print</span>(y)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="bu">print</span>() <span class="co"># This just puts a blank line between our other print statements</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>z <span class="op">=</span> x<span class="op">**</span><span class="dv">2</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="bu">print</span>(z)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>a <span class="op">=</span> np.sqrt(x)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="bu">print</span>(a)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[2 4 6 8]

[ 1  4  9 16]

[1.         1.41421356 1.73205081 2.        ]</code></pre>
</div>
<p>Note that in that last operation where we take the square root, we
made use of a <code>numpy</code> function <code>sqrt</code>. That
function
`<code>knows" how to operate on the elements of a numpy array, as opposed to the standard python</code>math<code>library which does *not* know how to work with</code>numpy`
arrays.</p>
<p>So this seems great! However, <code>numpy</code> arrays break down
when you have arrays that are not 1D and cannot be expressed in a
regular
`<code>n x m" format.  For example, suppose you have two events and each event has two muons and you  want to store the transverse momentum ($p_T$) for these muons in a</code>numpy`
array.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>pt <span class="op">=</span> np.array([[<span class="fl">20.9</span>, <span class="fl">12.3</span>], [<span class="fl">127.1</span>, <span class="fl">60.2</span>]])</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>pt</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="bu">print</span>(pt)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="bu">print</span>(x)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[ 20.9  12.3]
 [127.1  60.2]]

 [[ 41.8  24.6]
  [254.2 120.4]]</code></pre>
</div>
<p>Great! Everything looks good and we get our expected behavior!</p>
<p>Now, suppose there are <em>3</em> muons in the second event. Does
this still work?</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>pt <span class="op">=</span> np.array([[<span class="fl">20.9</span>, <span class="fl">12.3</span>], [<span class="fl">127.1</span>, <span class="fl">60.2</span>, <span class="fl">23.8</span>]])</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>pt</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="bu">print</span>(x)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[list([20.9, 12.3, 20.9, 12.3])
     list([127.1, 60.2, 23.8, 127.1, 60.2, 23.8])]</code></pre>
</div>
<p>Wait…what??? It looks like it just duplicated the entries so now it
looks like we’re storing information for <em>4</em> muons in the first
event and <em>6</em> muons in the second event! A closer looks shows us
that while <code>pt</code> is a <code>numpy</code> array, the elements
are not arrays but python <code>list</code> objects, which behave
differently.</p>
<p>The reason this happened is that <code>numpy</code> arrays can’t deal
with this type of
`<code>jagged" behavior where the first row of your data might have 2 elements and the second row might have 3 elements and the third row might have 0 elements and so on. For that, we need</code>awkward-array`.</p>
</section><section><h2 class="section-heading" id="access-or-download-a-root-file-for-use-with-this-exercise">Access or download a ROOT file for use with this exercise<a class="anchor" aria-label="anchor" href="#access-or-download-a-root-file-for-use-with-this-exercise"></a>
<a class="anchor" aria-label="anchor" href="#access-or-download-a-root-file-for-use-with-this-exercise"></a></h2>
<hr class="half-width"><p>We’ll work with the same file as in the previous lesson. If you have
jumped straight to this lesson, please go back and review how to access
the file over the network or by downloading it.</p>
</section><section><h2 class="section-heading" id="open-the-file">Open the file<a class="anchor" aria-label="anchor" href="#open-the-file"></a>
<a class="anchor" aria-label="anchor" href="#open-the-file"></a></h2>
<hr class="half-width"><div id="stop" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="stop" class="callout-inner">
<h3 class="callout-title">
<em>Stop!</em><a class="anchor" aria-label="anchor" href="#stop"></a>
</h3>
<div class="callout-content">
<p>If you haven’t already, make sure you have run through the <a href="https://cms-opendata-workshop.github.io/workshop2024-lesson-cpp-root-python/06-uproot/index.html" class="external-link">previous
lesson</a> on working with uproot.</p>
</div>
</div>
</div>
<p>Let’s open this ROOT file! If you’re writing a python script, let’s
call it <code>open_root_file_and_analyze_data.py</code> and if you’re
using a Jupyter notebook, let’s call it
<code>open_root_file_and_analyze_data.ipynb</code>.</p>
<p>First we will import the <code>uproot</code> library, as well as some
other standard libraries. These can be the first lines of your python
script or the first cell of your Jupyter notebook.</p>
<p><em>If this is a script, you may want to run
<code>python open_root_file_and_analyze_data.py</code> every few lines
or so to see the output. If this is a Jupyter notebook, you will want to
put each snippet of code in its own cell and execute them as you go to
see the output.</em></p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="im">import</span> uproot</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="im">import</span> awkward <span class="im">as</span> ak</span></code></pre>
</div>
<p>Let’s open the file and pull out some data.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Depending on if you downloaded the file or not, you'll use either</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>infile_name <span class="op">=</span> <span class="st">'root://eospublic.cern.ch//eos/opendata/cms/derived-data/AOD2NanoAODOutreachTool/ForHiggsTo4Leptons/SMHiggsToZZTo4L.root'</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co"># or </span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#infile_name = 'SMHiggsToZZTo4L.root'</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co"># Uncomment the above line if you downloaded the file.</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>infile <span class="op">=</span> uproot.<span class="bu">open</span>(infile_name)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>events <span class="op">=</span> infile[<span class="st">'Events'</span>]</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>pt <span class="op">=</span> events[<span class="st">'Muon_pt'</span>]</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>eta <span class="op">=</span> events[<span class="st">'Muon_eta'</span>]</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>phi <span class="op">=</span> events[<span class="st">'Muon_phi'</span>]</span></code></pre>
</div>
<p>Let’s inspect these objects a little closer. To access the actual
values, we’ll see we need to use the <code>.array()</code> member
function.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="bu">print</span>(pt)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="bu">print</span>(pt.array())</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(pt.array()))</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>    <span class="bu">print</span>(pt.array()[i])</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;TBranch 'Muon_pt' at 0x7f01513a5c88&gt;

[[63, 38.1, 4.05], [], [], [54.3, 23.5, ... 43.1], [4.32, 4.36, 5.63, 4.75], [], []]

299973

[63, 38.1, 4.05]
[]
[]
[54.3, 23.5, 52.9, 4.33, 5.35, 8.39, 3.49]
[]</code></pre>
</div>
<p>Taking a closer look at the entries, we see different numbers of
values in each ``row”, where the rows correspond to events recorded in
the CMS detector.</p>
<p>So can we use manipulate this object like a numpy array? Yes! If
we’re careful about accessing the array properly.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">2</span><span class="op">*</span>pt.array()</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="bu">print</span>(x[<span class="dv">0</span>:<span class="dv">5</span>])</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[126, 76.2, 8.1], [], [], [109, 47, 106, 8.66, 10.7, 16.8, 6.98], []]</code></pre>
</div>
<p>When we histogram, however, we need to make use of the
<code>awkward.flatten</code> function. This turns our
<code>awkward</code> array into a 1-dimensional array, so that we lose
all record of what muon belonged to which event.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="bu">print</span>(ak.flatten(pt.array()))</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>plt.figure()</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>plt.hist(ak.flatten(pt.array()),bins<span class="op">=</span><span class="dv">100</span>,<span class="bu">range</span><span class="op">=</span>(<span class="dv">0</span>,<span class="dv">100</span>))<span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>plt.xlabel(<span class="vs">r'Muon $p_T$ (GeV/c)'</span>,fontsize<span class="op">=</span><span class="dv">14</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[63, 38.1, 4.05, 54.3, 23.5, 52.9, 4.33, ... 32.6, 43.1, 4.32, 4.36, 5.63, 4.75]</code></pre>
</div>
<figure><img src="fig//awkward_muon_pt.png" class="figure mx-auto d-block"></figure><p>We can also manipulate the data quite quickly. Let’s see how!</p>
<p>This sample file is Monte Carlo data that simulates the decay of
Higgs bosons to 4 charged leptons. Let’s look for decays to 4 muons,
where there are two positively charged muons and 2 negatively charged
muons.</p>
<p>Since the data stores momentum information as <span class="math inline">\(p_T, \eta, \phi\)</span>, first we’ll calculate
the Cartesian <span class="math inline">\(x,y,z\)</span> components of
momentum, and then we’ll <em>loop</em> over our events to calculate an
invariant mass. We’ll find that looping over the entries is slow, but
there is a faster way!</p>
<p>First the slow but explicit way:</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Python code (event loop)
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Some helper functions</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="kw">def</span> energy(m, px, py, pz):    </span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>    E <span class="op">=</span> np.sqrt( (m<span class="op">**</span><span class="dv">2</span>) <span class="op">+</span> (px<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> py<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> pz<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>    <span class="cf">return</span> E</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>   </span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="kw">def</span> invmass(E, px, py, pz):</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>    m2 <span class="op">=</span> (E<span class="op">**</span><span class="dv">2</span>) <span class="op">-</span> (px<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> py<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> pz<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>   </span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>    <span class="cf">if</span> m2 <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>        m <span class="op">=</span> <span class="op">-</span>np.sqrt(<span class="op">-</span>m2)</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>        m <span class="op">=</span> np.sqrt(m2)</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>    <span class="cf">return</span> m</span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="kw">def</span> convert(pt, eta, phi):</span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>    px <span class="op">=</span> pt <span class="op">*</span> np.cos(phi)</span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>    py <span class="op">=</span> pt <span class="op">*</span> np.sin(phi)</span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>    pz <span class="op">=</span> pt <span class="op">*</span> np.sinh(eta)</span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a>    </span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a>    <span class="cf">return</span> px, py, pz</span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a><span class="co"># Convert momentum to x,y,z components</span></span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a>muon_number <span class="op">=</span> events[<span class="st">'nMuon'</span>].array()</span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a>pt <span class="op">=</span> events[<span class="st">'Muon_pt'</span>].array()</span>
<span id="cb18-28"><a href="#cb18-28" tabindex="-1"></a>eta <span class="op">=</span> events[<span class="st">'Muon_eta'</span>].array()</span>
<span id="cb18-29"><a href="#cb18-29" tabindex="-1"></a>phi <span class="op">=</span> events[<span class="st">'Muon_phi'</span>].array()</span>
<span id="cb18-30"><a href="#cb18-30" tabindex="-1"></a>muon_q <span class="op">=</span> events[<span class="st">'Muon_charge'</span>].array()</span>
<span id="cb18-31"><a href="#cb18-31" tabindex="-1"></a>mass <span class="op">=</span> events[<span class="st">'Muon_mass'</span>].array()</span>
<span id="cb18-32"><a href="#cb18-32" tabindex="-1"></a></span>
<span id="cb18-33"><a href="#cb18-33" tabindex="-1"></a>muon_px,muon_py,muon_pz <span class="op">=</span> convert(pt, eta, phi)</span>
<span id="cb18-34"><a href="#cb18-34" tabindex="-1"></a>muon_e <span class="op">=</span> energy(mass, muon_px, muon_py, muon_pz)</span>
<span id="cb18-35"><a href="#cb18-35" tabindex="-1"></a></span>
<span id="cb18-36"><a href="#cb18-36" tabindex="-1"></a><span class="co"># Do the calculation</span></span>
<span id="cb18-37"><a href="#cb18-37" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" tabindex="-1"></a>masses <span class="op">=</span> []</span>
<span id="cb18-39"><a href="#cb18-39" tabindex="-1"></a></span>
<span id="cb18-40"><a href="#cb18-40" tabindex="-1"></a>nevents <span class="op">=</span> <span class="bu">len</span>(pt)</span>
<span id="cb18-41"><a href="#cb18-41" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Nevents: </span><span class="sc">{</span>nevents<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-42"><a href="#cb18-42" tabindex="-1"></a></span>
<span id="cb18-43"><a href="#cb18-43" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb18-44"><a href="#cb18-44" tabindex="-1"></a></span>
<span id="cb18-45"><a href="#cb18-45" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(nevents):</span>
<span id="cb18-46"><a href="#cb18-46" tabindex="-1"></a></span>
<span id="cb18-47"><a href="#cb18-47" tabindex="-1"></a>    <span class="cf">if</span> n<span class="op">%</span><span class="dv">10000</span><span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb18-48"><a href="#cb18-48" tabindex="-1"></a>        <span class="bu">print</span>(n)</span>
<span id="cb18-49"><a href="#cb18-49" tabindex="-1"></a></span>
<span id="cb18-50"><a href="#cb18-50" tabindex="-1"></a>    nmuons <span class="op">=</span> muon_number[n]</span>
<span id="cb18-51"><a href="#cb18-51" tabindex="-1"></a>    </span>
<span id="cb18-52"><a href="#cb18-52" tabindex="-1"></a>    e <span class="op">=</span> muon_e[n]</span>
<span id="cb18-53"><a href="#cb18-53" tabindex="-1"></a>    q <span class="op">=</span> muon_q[n]</span>
<span id="cb18-54"><a href="#cb18-54" tabindex="-1"></a>    px <span class="op">=</span> muon_px[n] </span>
<span id="cb18-55"><a href="#cb18-55" tabindex="-1"></a>    py <span class="op">=</span> muon_py[n]</span>
<span id="cb18-56"><a href="#cb18-56" tabindex="-1"></a>    pz <span class="op">=</span> muon_pz[n]</span>
<span id="cb18-57"><a href="#cb18-57" tabindex="-1"></a>    </span>
<span id="cb18-58"><a href="#cb18-58" tabindex="-1"></a></span>
<span id="cb18-59"><a href="#cb18-59" tabindex="-1"></a>    <span class="cf">if</span> nmuons <span class="op">&lt;</span> <span class="dv">4</span>:</span>
<span id="cb18-60"><a href="#cb18-60" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb18-61"><a href="#cb18-61" tabindex="-1"></a>    </span>
<span id="cb18-62"><a href="#cb18-62" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, nmuons<span class="op">-</span><span class="dv">3</span>):</span>
<span id="cb18-63"><a href="#cb18-63" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i<span class="op">+</span><span class="dv">1</span>, nmuons<span class="op">-</span><span class="dv">2</span>):</span>
<span id="cb18-64"><a href="#cb18-64" tabindex="-1"></a>            <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(j<span class="op">+</span><span class="dv">1</span>, nmuons<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb18-65"><a href="#cb18-65" tabindex="-1"></a>                <span class="cf">for</span> l <span class="kw">in</span> <span class="bu">range</span>(k<span class="op">+</span><span class="dv">1</span>, nmuons):</span>
<span id="cb18-66"><a href="#cb18-66" tabindex="-1"></a></span>
<span id="cb18-67"><a href="#cb18-67" tabindex="-1"></a>                    <span class="cf">if</span> q[i] <span class="op">+</span> q[j] <span class="op">+</span> q[k] <span class="op">+</span> q[l] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb18-68"><a href="#cb18-68" tabindex="-1"></a>                        etot <span class="op">=</span> e[i] <span class="op">+</span> e[j] <span class="op">+</span> e[k] <span class="op">+</span> e[l]</span>
<span id="cb18-69"><a href="#cb18-69" tabindex="-1"></a>                        pxtot <span class="op">=</span> px[i] <span class="op">+</span> px[j] <span class="op">+</span> px[k] <span class="op">+</span> px[l]</span>
<span id="cb18-70"><a href="#cb18-70" tabindex="-1"></a>                        pytot <span class="op">=</span> py[i] <span class="op">+</span> py[j] <span class="op">+</span> py[k] <span class="op">+</span> py[l]</span>
<span id="cb18-71"><a href="#cb18-71" tabindex="-1"></a>                        pztot <span class="op">=</span> pz[i] <span class="op">+</span> pz[j] <span class="op">+</span> pz[k] <span class="op">+</span> pz[l]</span>
<span id="cb18-72"><a href="#cb18-72" tabindex="-1"></a></span>
<span id="cb18-73"><a href="#cb18-73" tabindex="-1"></a>                        m <span class="op">=</span> invmass(etot, pxtot, pytot, pztot)</span>
<span id="cb18-74"><a href="#cb18-74" tabindex="-1"></a>                        masses.append(m)</span>
<span id="cb18-75"><a href="#cb18-75" tabindex="-1"></a>                        </span>
<span id="cb18-76"><a href="#cb18-76" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Time to run: </span><span class="sc">{</span>(time.time() <span class="op">-</span> start)<span class="sc">}</span><span class="ss"> seconds"</span>) </span>
<span id="cb18-77"><a href="#cb18-77" tabindex="-1"></a></span>
<span id="cb18-78"><a href="#cb18-78" tabindex="-1"></a><span class="co"># Plot the results</span></span>
<span id="cb18-79"><a href="#cb18-79" tabindex="-1"></a></span>
<span id="cb18-80"><a href="#cb18-80" tabindex="-1"></a>plt.figure()</span>
<span id="cb18-81"><a href="#cb18-81" tabindex="-1"></a>plt.hist(masses,bins<span class="op">=</span><span class="dv">140</span>,<span class="bu">range</span><span class="op">=</span>(<span class="dv">80</span>,<span class="dv">150</span>))</span>
<span id="cb18-82"><a href="#cb18-82" tabindex="-1"></a>plt.xlabel(<span class="vs">r'4-muon invariant mass (GeV/c$^2$'</span>,fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb18-83"><a href="#cb18-83" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<figure><img src="fig/awkward_Higgs_4l_loop.png" class="figure mx-auto d-block"></figure><p>When I run this on my laptop, it takes a little over 3 minutes to
run. Is there a better way?</p>
<p>Yes!</p>
<p>We’ve adapted some code from <a href="https://hsf-training.github.io/hsf-training-scikit-hep-webpage/04-awkward/index.html" class="external-link">this
tutorial</a>, put together by the HEP Software Foundation to show you
how much faster using the built-in awkward functions can be:</p>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Python code (awkward array)
  </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler2" aria-labelledby="headingSpoiler2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>muons <span class="op">=</span> ak.<span class="bu">zip</span>({</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>    <span class="st">"px"</span>: muon_px,</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>    <span class="st">"py"</span>: muon_py,</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>    <span class="st">"pz"</span>: muon_pz,</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>    <span class="st">"e"</span>: muon_e,</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>    <span class="st">"q"</span>: muon_q,</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>})</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>quads <span class="op">=</span> ak.combinations(muons, <span class="dv">4</span>)</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>mu1, mu2, mu3, mu4 <span class="op">=</span> ak.unzip(quads)</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>mass_fast <span class="op">=</span> (mu1.e <span class="op">+</span> mu2.e <span class="op">+</span> mu3.e <span class="op">+</span> mu4.e)<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> ((mu1.px <span class="op">+</span> mu2.px <span class="op">+</span> mu3.px <span class="op">+</span> mu4.px)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (mu1.py <span class="op">+</span> mu2.py <span class="op">+</span> mu3.py <span class="op">+</span> mu4.py)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (mu1.pz <span class="op">+</span> mu2.pz <span class="op">+</span> mu3.pz <span class="op">+</span> mu4.pz)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>mass_fast <span class="op">=</span> np.sqrt(mass_fast)</span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>qtot <span class="op">=</span> mu1.q <span class="op">+</span> mu2.q <span class="op">+</span> mu3.q <span class="op">+</span> mu4.q</span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Time to run: </span><span class="sc">{</span>(time.time() <span class="op">-</span> start)<span class="sc">}</span><span class="ss"> seconds"</span>) </span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a>plt.hist(ak.flatten(mass_fast[qtot<span class="op">==</span><span class="dv">0</span>]), bins<span class="op">=</span><span class="dv">140</span>,<span class="bu">range</span><span class="op">=</span>(<span class="dv">80</span>,<span class="dv">150</span>))<span class="op">;</span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a>plt.xlabel(<span class="vs">r'4-muon invariant mass (GeV/c$^2$'</span>,fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<figure><img src="fig/awkward_Higgs_4l_ak_zip.png" class="figure mx-auto d-block"></figure><p>On my laptop, this takes less than 0.2 seconds! Note that we are
making use of <a href="https://jakevdp.github.io/PythonDataScienceHandbook/02.06-boolean-arrays-and-masks.html" class="external-link">boolean
arrays to perform masking</a> when we type
<code>mass_fast[qtot==0]</code>.</p>
<p>While we cannot teach you <em>everything</em> about
<code>awkward</code>, we hope we’ve given you a basic introduction to
what it can do and where you can find more information so that you can
quickly process the output of any of your open data jobs and get started
on your own analysis!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Awkward arrays can help speed up your code, but it requires a
different way of thinking and more awareness of what functions are coded
up in the awkward library.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="06-uproot.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="06-uproot.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Using uproot to open
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/cms-opendata-workshop/workbench-template-md/edit/main/episodes/07-awkward.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/cms-opendata-workshop/workbench-template-md/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/cms-opendata-workshop/workbench-template-md/" class="external-link">Source</a></p>
				<p><a href="https://github.com/cms-opendata-workshop/workbench-template-md/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:cms-dpoa-coordinator@cern.ch">Contact</a> | <a href="https://opendata.cern.ch/docs/about-cms" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.5" class="external-link">sandpaper (0.16.5)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/cms-opendata-workshop/varnish/tree/405b7a74ee1b2fc89c3e49e116ce96d4d65182b3" class="external-link">varnish (1.0.3)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://cms-opendata-workshop.github.io/workbench-template-md/07-awkward.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, CMS",
  "name": "Using awkward arrays to analyze HEP data",
  "creativeWorkStatus": "active",
  "url": "https://cms-opendata-workshop.github.io/workbench-template-md/07-awkward.html",
  "identifier": "https://cms-opendata-workshop.github.io/workbench-template-md/07-awkward.html",
  "dateCreated": "2024-07-29",
  "dateModified": "2024-07-02",
  "datePublished": "2024-07-09"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

